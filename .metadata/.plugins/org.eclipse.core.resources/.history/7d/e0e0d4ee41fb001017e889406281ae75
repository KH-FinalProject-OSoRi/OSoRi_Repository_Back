package com.kh.osori.notification.model.service;
import java.util.List;

import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.messaging.simp.SimpMessagingTemplate;
import org.springframework.stereotype.Service;

import com.kh.osori.notification.model.Dao.NotificationDao;
import com.kh.osori.notification.model.vo.Notification;
import com.kh.osori.notification.model.vo.WebSocketConfig;

@Service
public class NotificationService {
    @Autowired
    private SimpMessagingTemplate messageTemp;
	
	@Autowired
	private NotificationDao dao;
	
	@Autowired
	private SqlSessionTemplate sqlSession;
	
	public void sendMessageToMembers(List<String> userIds, String sender, String message, String type, int inviteNum) {
		int result = 0;
		for(String receiver : userIds) {
			Notification noti = Notification.builder()
											.nType(type)
											.sender(sender)
											.receiver(receiver)
											.isRead("N")
											.message(message)
											.inviteNum(0)
											.build();
			
			result += dao.insertNotification(noti);
			
			// 실시간 WebSocket 개별 전송
			messageTemp.convertAndSendToUser(receiver, "/single/notifications",noti);
		}
		
		
	}

}
